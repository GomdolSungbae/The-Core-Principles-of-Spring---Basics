# ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘
DB ì—°ê²°, ì†Œì¼“ ì—°ê²° ë“±ì€ 3-way handshake ë“±ì„ ê±°ì³ ì‹œê°„ì´ ê½¤ ì†Œìš”ë˜ëŠ” ì‘ì—…ì´ë‹¤.

ë”°ë¼ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— í•„ìš”í•œ ì—°ê²°ì„ ë¯¸ë¦¬ í•´ë‘ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì ì— ì—°ê²°ì„ ëª¨ë‘ ì¢…ë£Œí•˜ê¸° ìœ„í•´ì„œëŠ” ê°ì²´ì˜ ì´ˆê¸°í™” ë° ì¢…ë£Œ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

ì•„ë˜ì™€ ê°™ì€ ì˜ˆì œë¥¼ ë³´ì.

``` java
package hello.core.lifecycle;

public class NetworkClient {
    private String url;

    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ , url=" + url);
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì„¸ì§€");
    }

    public void call(String msg) {
        System.out.println("call= " + url + " message= " + msg);
    }

    public void connect() {
        System.out.println("connect= " + url);
    }

    public void disconnect() {
        System.out.println("close= " + url);
    }

    public void setUrl(String url) {
        this.url = url;
    }
}
```

``` java
package hello.core.lifecycle;

import org.junit.jupiter.api.Test;
import org.springframework.context.ConfigurableApplicationContext;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

public class BeanLifeCycleTest {

    @Test
    public void lifeCycleTest() {
        ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(LifeCycleConfig.class);
        NetworkClient client = ac.getBean(NetworkClient.class);
        ac.close();
    }

    @Configuration
    static class LifeCycleConfig {
        @Bean
        public NetworkClient networkClient() {
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("http://hello-spring.dev");

            return networkClient;
        }
    }
}
```

ìœ„ í…ŒìŠ¤íŠ¸ì˜ ê²°ê³¼ëŠ” ëª¨ë‘ urlì´ nullìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ”ë°, `NetworkClient networkClient = new NetworkClient();` ì—ì„œ ê°ì²´ ìƒì„± ì‹œì ì—ì„œëŠ” ë‹¹ì—°íˆ urlì´ ì…ë ¥ë˜ì§€ ì•Šì€ ìƒíƒœì´ê³ , ëª¨ë‘ ìƒì„±ì„ ì™„ë£Œ í›„ì— setterë¥¼ í†µí•´ urlì„ ì£¼ì…í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.
ì¦‰, ê°ì²´ ìƒì„± ë‹¨ê³„ì—ëŠ” urlì´ ì—†ê³ , ê°ì²´ ìƒì„± ì´í›„ ìˆ˜ì •ì ì£¼ì…ì„ í†µí•´ setUrl() í˜¸ì¶œ ì´í›„ì— urlì´ ì¡´ì¬í•œë‹¤.

ìŠ¤í”„ë§ì€ **[ê°ì²´ ìƒì„± -> ì˜ì¡´ê´€ê³„ ì£¼ì…]** ì˜ ë¼ì´í”„ ì‚¬ì´í´ì„ ê°–ëŠ”ë‹¤.(ìƒì„±ì ì£¼ì…ì€ ì˜ˆì™¸)

ë”°ë¼ì„œ ì´ˆê¸°í™” ì‘ì—…ì€ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ëª¨ë‘ ì™„ë£Œë˜ê³  ë‚œ ë‹¤ìŒì— í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ë°, ìŠ¤í”„ë§ì€ ì˜ì¡´ê´€ê³„ ì£¼ì… ì™„ë£Œ ì´í›„ ìŠ¤í”„ë§ ë¹ˆì—ê²Œ ì½œë°± ë©”ìŠ¤ë“œë¥¼ í†µí•´ ì´ˆê¸°í™” ì‹œì ì„ ì•Œë ¤ì£¼ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.
ë˜í•œ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ê¸° ì§ì „ ì†Œë©¸ ì½œë°±ë„ ê°€ëŠ¥í•˜ë‹¤.

## ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë²¤íŠ¸ ë¼ì´í”„ ì‚¬ì´í´
![image](https://github.com/user-attachments/assets/42aa0809-8614-4996-9c74-9aac590deab0)
ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± -> ìŠ¤í”„ë§ ë¹ˆ ìƒì„± -> ì˜ì¡´ê´€ê³„ ì£¼ì… -> ì´ˆê¸°í™” ì½œë°± -> ì‚¬ìš©(ì–´í”Œë¦¬ì¼€ì´ì…˜ êµ¬ë™) -> ì†Œë©¸ì „ ì½œë°± -> ìŠ¤í”„ë§ ì¢…ë£Œ

-  ì´ˆê¸°í™” ì½œë°± : ë¹ˆ ìƒì„±, ì˜ì¡´ê´€ê³„ ì£¼ì… ì™„ë£Œ í›„ í˜¸ì¶œ
-  ì†Œë©¸ì „ ì½œë°± : ë¹ˆì´ ì†Œë©¸ë˜ê¸° ì§ì „ í˜¸ì¶œ

> ğŸ‹ **ê°ì²´ì˜ ìƒì„±ê³¼ ì´ˆê¸°í™”ë¥¼ ë¶„ë¦¬**í•˜ì.
> 
> ìƒì„±ìëŠ”  í•„ìˆ˜ ì •ë³´(íŒŒë¼ë¯¸í„°)ë¥¼ ë°›ì•„ ë©”ëª¨ë¦¬ í• ë‹¹ í›„ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì±…ì„ì„ ê°€ì§„ë‹¤.
> ë°˜ë©´, ì´ˆê¸°í™”ëŠ” ì´ë ‡ê²Œ ìƒì„±ëœ ê°’ë“¤ì„ í™œìš”í•´ ì™¸ë¶€ ì»¤ë„¥ì…˜ì„ ì—°ê²°í•˜ëŠ” ë“±ì˜ ë¬´ê±°ìš´ ì‘ì—…ë“¤ì„ ìˆ˜í–‰í•œë‹¤.
> 
> ë”°ë¼ì„œ SRP(ë‹¨ì¼ ì±…ì„ ì›ì¹™) ê´€ì ì—ì„œë„ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ê³¼ ì´ˆê¸°í™”ë¥¼ í•˜ëŠ” ë¶€ë¶„ì„ ëª…í™•í•˜ê²Œ  ë‚˜ëˆ„ëŠ” ê²ƒì´ ìœ ì§€ë³´ìˆ˜ ë° ê°ì²´ì§€í–¥ ê´€ì ì—ì„œë„ ì¢‹ë‹¤.

# ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean
- `ÃŒnitializingBean`ì€ `afterPropertiesSet()` ë©”ì„œë“œë¡œ ì´ˆê¸°í™” ì§€ì›
- `DisposableBean`ì€ `destroy()` ë©”ì„œë“œë¡œ ì†Œë©¸ ì§€ì›

```  java
package hello.core.lifecycle;

import org.springframework.beans.factory.DisposableBean;
import org.springframework.beans.factory.InitializingBean;

public class NetworkClient implements InitializingBean, DisposableBean {

    private String url;

    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ , url=" + url);
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì„¸ì§€");
    }

    public void call(String msg) {
        System.out.println("call= " + url + " message= " + msg);
    }

    public void connect() {
        System.out.println("connect= " + url);
    }

    public void disconnect() {
        System.out.println("close= " + url);
    }

    public void setUrl(String url) {
        this.url = url;
    }

    @Override
    public void afterPropertiesSet() throws Exception {
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì„¸ì§€");
    }

    @Override
    public void destroy() throws Exception {
        disconnect();
    }
}
```

### ì´ˆê¸°í™”, ì†Œë©¸ ì¸í„°í˜ì´ìŠ¤ ë‹¨ì 
- ìŠ¤í”„ë§ ì „ìš© ì¸í„°í˜ì´ìŠ¤ë¡œ, í•´ë‹¹ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤.
- @Overrideì´ê¸° ë•Œë¬¸ì— ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œì˜ ì´ë¦„ì„ ë³€ê²½í•  ìˆ˜ ì—†ê³ , ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì ìš©í•  ìˆ˜ ì—†ë‹¤.

ë”°ë¼ì„œ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ë°©ì‹ì´ë‹¤.

# ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ ì§€ì •
ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡ ì• ë…¸í…Œì´ì…˜ `@Bean`ì— ì†ì„±ìœ¼ë¡œ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œë¥¼ ì§€ì •í•  ìˆ˜ ìˆë‹¤. 

`@Bean(initMethod = "ì´ˆê¸°í™”ë©”ì„œë“œëª…", destroyMethod="ì†Œë©¸ë©”ì„œë“œëª…")`

``` java
public class NetworkClient{

    ...

    public void init() {
        System.out.println("NetworkClient.init");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì„¸ì§€");
    }

    public void close() {
        System.out.println("NetworkClient.close");
        disconnect();
    }
}
```

ì•„ë˜ì™€ ê°™ì´ ì„¤ì • ì •ë³´ì— ì´ˆê¸°í™” ì†Œë©¸ ë©”ì„œë“œ ì´ë¦„ì„ ì§€ì •í•œë‹¤.
``` java
@Configuration
static class LifeCycleConfig {
    @Bean(initMethod = "init", destroyMethod = "close")
    public NetworkClient networkClient() {
        NetworkClient networkClient = new NetworkClient();
        networkClient.setUrl("http://hello-spring.dev");

        return networkClient;
    }
}
```

### ì„¤ì • ì •ë³´ ì‚¬ìš© íŠ¹ì§•
- ë©”ì„œë“œ ì´ë¦„ì„ ììœ ë¡­ê²Œ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
- ìŠ¤í”„ë§ ë¹ˆì´ ìŠ¤í”„ë§ì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ì½”ë“œê°€ ì•„ë‹Œ ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ë„ ì ìš©í•  ìˆ˜ ìˆë‹¤.

### ì¢…ë£Œ ë©”ì„œë“œ ì¶”ë¡ 

<img width="691" alt="image" src="https://github.com/user-attachments/assets/eff9e130-3808-41ad-97c5-9438f51e8fc6" />

@Bean ì• ë…¸í…Œì´ì…˜ì˜ ì†Œë©¸ë©”ì„œë“œë¥¼ ì§€ì •í•˜ëŠ” ì†ì„±ì¸ destroyMethod ì—ëŠ” ì¶”ë¡ ê¸°ëŠ¥ì´ ìˆë‹¤. 

**ê´€ë¡€ì ìœ¼ë¡œ ëŒ€ë¶€ë¶„ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œëŠ” close, shutdown ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì†Œë©¸ ë©”ì„œë“œë¥¼ ì‚¬ìš©**í•œë‹¤.
ë”°ë¼ì„œ @Bean ì˜ destroyMethodëŠ” default ê°’ìœ¼ë¡œ (inferred)(ì¶”ë¡ )ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆëŠ”ë°, ì´ ê¸°ëŠ¥ì€ close, shutdownì´ë¼ëŠ” ì´ë¦„ì˜ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ í˜¸ì¶œí•œë‹¤. 
ë”°ë¼ì„œ, ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆì„ ë“±ë¡í• ë•Œ ì¢…ë£Œ ë©”ì„œë“œë¥¼ í•´ë‹¹ ê´€ë¡€ë¥¼ ë”°ë¥´ëŠ” closeë‚˜ shutdownìœ¼ë¡œ ì§€ì •í•œë‹¤ë©´ ë”°ë¡œ ì†ì„±ì— destroyMethodì— ì§€ì •í•´ì£¼ì§€ ì•Šì•„ë„, ìë™ìœ¼ë¡œ ì°¾ì•„ì„œ ë™ì‘í•œë‹¤.
ì¶”ë¡  ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ì‹«ì„ê²½ìš° ê³µë°±("")ì„ ì§€ì •í•˜ë©´ ëœë‹¤. 

# ì• ë…¸í…Œì´ì…˜ @PostConstruct, @PreDestroy
- `javax` ëŠ” ìë°” ì§„ì˜ì—ì„œ ê³µì‹ìœ¼ë¡œ ì§€ì›í•˜ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ Springì„ ì“°ì§€ ì•Šê³  ë‹¤ë¥¸ DIë¥¼ ì‚¬ìš©í•´ë„ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

``` java
public class NetworkClient{
    ...

    @PostConstruct
    public void init() {
        System.out.println("NetworkClient.init");
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì„¸ì§€");
    }

    @PreDestroy
    public void close() {
        System.out.println("NetworkClient.close");
        disconnect();
    }
}
```

### @PostConstruct, @PreDestroy íŠ¹ì§•
- ìŠ¤í”„ë§ì—ì„œ ê¶Œì¥í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ, ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë§Œ ë¶™ì—¬ì„œ ë§¤ìš° í¸ë¦¬í•˜ë‹¤.
- ìŠ¤í”„ë§ì— ì¢…ì†ì ì´ì§€ ì•ŠëŠ”, ìë°” í‘œì¤€ì´ë‹¤.
- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ì˜ ì–´ìš¸ë¦°ë‹¤.
- ìœ ì¼í•œ ë‹¨ì ì€ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì ìš©í•  ìˆ˜ ì—†ë‹¤. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ì•ì˜ @Bean ì„¤ì • ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì.

# ì •ë¦¬
@PostConstruct, @PreDestroy ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ê³ , ì½”ë“œ ë³€ê²½ì´ ë¶ˆê°€ëŠ¥í•œ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ˆê¸°í™”, ì¢…ë£Œí•´ì•¼ í•  ê²½ìš° `@Bean`ì˜ `initMethod`, `destroyMethod`(close, shutdown ìë™ í˜¸ì¶œ)ë¥¼ ì‚¬ìš©í•˜ì.
