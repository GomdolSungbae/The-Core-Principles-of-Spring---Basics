# ìƒˆë¡œìš´ í• ì¸ ì •ì±… ê°œë°œ

> ğŸ’¡ì •ë¥  í• ì¸ ì •ì±…ìœ¼ë¡œ ë³€ê²½ -> DiscountPoliocy ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” RateDiscountPolicy êµ¬í˜„
![image](https://github.com/user-attachments/assets/0f1139de-cab3-4336-bc9c-fc299699d958)

### RateDiscountPolicy
``` java
public class RateDiscountPolicy implements DiscountPolicy {

  private int discountPercent = 10; //10% í• ì¸

  @Override
  public int discount(Member member, int price) {
    if (member.getGrade() == Grade.VIP) {
      return price * discountPercent / 100;
    } else {
      return 0;
    }
  }
}
```

ì´ ë•Œ, `return price * discountPercent / 100;` ì™€ ê°™ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ê²€ì¦í•˜ëŠ” í…ŒìŠ¤íŠ¸ì½”ë“œë¥¼ ê¼­ ì‘ì„±í•´ì•¼ í•¨.
ìˆ˜ì‹ ê²€ì¦, ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ ë“±

### í…ŒìŠ¤íŠ¸ ì½”ë“œ
í…ŒìŠ¤íŠ¸ì½”ë“œëŠ” ì„±ê³µì¼€ì´ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼, ë‹¤ì–‘í•œ ì‹¤íŒ¨ì¼€ì´ìŠ¤ë„ ê²€ì¦í•´ì•¼ í•œë‹¤.
ë”°ë¼ì„œ 1. VIP ê³ ê°ì˜ ì„±ê³µ ì¼€ì´ìŠ¤, 2. BASIC ê³ ê°ì˜ ì‹¤íŒ¨ ì¼€ì´ìŠ¤ì— ëŒ€í•´ ê²€ì¦í•œë‹¤.

``` java
class RateDiscountPolicyTest {

    RateDiscountPolicy discountPolicy = new RateDiscountPolicy();

    @Test
    @DisplayName("VIPëŠ” 10% í• ì¸ì´ ì ìš©ë˜ì–´ì•¼ í•œë‹¤")
    void vip_o() {
        // given
        Member member = new Member(1L, "memberVIP", Grade.VIP);

        // when
        int discount = discountPolicy.discount(member, 10000);

        // then
        assertThat(discount).isEqualTo(1000);
    }

    @Test
    @DisplayName("VIPê°€ ì•„ë‹ˆë©´ í• ì¸ì´ ì ìš©ë˜ì§€ ì•Šì•„ì•¼ í•œë‹¤")
    void vip_x() {
        // given
        Member member = new Member(2L, "memberBASIC", Grade.BASIC);

        // when
        int discount = discountPolicy.discount(member, 10000);

        // then
        assertThat(discount).isEqualTo(0);
    }
}
```

# ìƒˆë¡œìš´ í• ì¸ ì •ì±… ì ìš©ê³¼ ë¬¸ì œì 
ê¸°ì¡´ OrderServiceImple í´ë˜ìŠ¤ì—ì„œ í• ì¸ ì •ì±…ì„ ì •ë¥ ë¡œ ë³€ê²½í•´ë³´ì.

``` java
public class OrderServiceImpl implements OrderService {
  // private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
  private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
```

í•˜ì§€ë§Œ ìœ„ ì½”ë“œëŠ” OCP, DIPì™€ ê°™ì€ ê°ì²´ì§€í–¥ ì„¤ê³„ ì›ì¹™ì„ ìœ„ë°˜í•˜ëŠ” ì½”ë“œì´ë‹¤.

1. DIP ìœ„ë°˜
í´ë˜ìŠ¤ ì˜ì¡´ ê´€ê³„ë¥¼ ë¶„ì„í•´ë³´ë©´, OrderServiceImplì€ ì¶”ìƒ(ì¸í„°í˜ì´ìŠ¤) ë¿ë§Œ ì•„ë‹ˆë¼ êµ¬ì²´(êµ¬í˜„) í´ë˜ìŠ¤ì—ë„ ì˜ì¡´í•˜ê³  ìˆë‹¤.
- ì¶”ìƒ(ì¸í„°í˜ì´ìŠ¤) : `DiscountPolicy`
- êµ¬ì²´(êµ¬í˜„) : `FixDiscountPoolicy`, `RateDiscountPolicy`

2. OCP ìœ„ë°˜
í• ì¸ ì •ì±…ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤ì¸ OrderServiceImpl ì˜ ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì€ OCPë¥¼ ìœ„ë°˜í•œë‹¤.

í´ë˜ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ì„ í†µí•´ ì™œ í˜„ì¬ì™€ ê°™ì€ êµ¬ì¡°ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì½”ë“œë¥¼ ë³€ê²½í•˜ëŠ”ì§€, ê¸°ëŒ€í–ˆë˜ ì˜ì¡´ ê´€ê³„ëŠ” ë¬´ì—‡ì¸ì§€ ì‚´í´ë³´ì.

### ê¸°ëŒ€í•œ ì˜ì¡´ ê´€ê³„
![image](https://github.com/user-attachments/assets/032c2b6a-e6be-47f4-aa70-c23392012a9b)

### ì‹¤ì œ ì˜ì¡´ ê´€ê³„
ì‹¤ì œ ì˜ì¡´ê´€ê³„ë¥¼ ë³´ë©´, í´ë¼ì´ì–¸íŠ¸ì¸ OrderServiceImplì€ DiscountPolicyì¸ ì¸í„°í˜ì´ìŠ¤ ë¿ë§Œ ì•„ë‹ˆë¼, FixDiscountPoilcy êµ¬í˜„ í´ë˜ìŠ¤ì—ë„ í•¨ê»˜ ì˜ì¡´í•˜ê³  ìˆë‹¤.
![image](https://github.com/user-attachments/assets/1a5a58d2-4fe2-450d-b68f-81eb7e72f4e0)

## ë¬¸ì œ í•´ê²° ë°©ë²• 1 - ì¶”ìƒí™”ì— ì˜ì¡´
- DIPë¥¼ ìœ„ë°˜í•˜ì§€ ì•Šë„ë¡ ì¶”ìƒ(ì¸í„°í˜ì´ìŠ¤)ì—ë§Œ ì˜ì¡´í•˜ë„ë¡ ë³€ê²½í•œë‹¤.
``` java
public class OrderServiceImpl implements OrderService {
//private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
  private DiscountPolicy discountPolicy;
}
```

ê·¸ëŸ¬ë‚˜ ìœ„ì˜ ì½”ë“œì—ëŠ” êµ¬í˜„ì²´ê°€ ì—†ì–´ NPEê°€ ë°œìƒí•œë‹¤. 
ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ **ì™¸ë¶€ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì¸ OrderServiceImplì— DiscountPolicyì˜ êµ¬í˜„ ê°ì²´ë¥¼ ëŒ€ì‹  ìƒì„±í•´ ì£¼ì…**í•´ì•¼ í•œë‹¤.

## ë¬¸ì œ í•´ê²° ë°©ë²• 2 - ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
í˜„ì¬ OrderServiceImplì€ ì§ì ‘ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ì˜ì¡´(ì•Œê³ ìˆëŠ”)í•˜ê³  ìˆì–´ ë‹¤ì–‘í•œ ì±…ì„ì„ ê°€ì§€ê³  ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.
ì´ëŸ¬í•œ ë¬¸ì œëŠ” ê´€ì‹¬ì‚¬ ë¶„ë¦¬ë¥¼ í†µí•´ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
ì—¬ê¸°ì„œì˜ ê´€ì‹¬ ë¶„ë¦¬ëŠ” êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•´ ì˜ì¡´ê´€ê³„ë¥¼ ëŒ€ì‹  ì„¤ì •í•˜ëŠ” ì±…ì„ì„ ë§í•œë‹¤.

ê´€ì‹¬ì‚¬ ë¶„ë¦¬ë¥¼ í†µí•´ 

1. ê°ì²´ ìƒì„± ë° ì—°ê´€ê´€ê³„ ì„¤ì •
2. ì‹¤í–‰

ë‘ ê°€ì§€ì˜ ì—­í•  ë° ì±…ì„ì„ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.

## AppConfig
ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì „ì²´ ë™ì‘ ë°©ì‹ì„ êµ¬ì„± í´ë˜ìŠ¤ë¡œ, êµ¬í˜„ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì—°ê²° ë° ì„¤ì •(Config)í•˜ëŠ” ì±…ì„ì„ ê°€ì§„ë‹¤.

``` java
public class AppConfig {

  public MemberService memberService() {
    return new MemberServiceImpl(new MemoryMemberRepository());
  }

  public OrderService orderService() {
    return new OrderServiceImpl(
      new MemoryMemberRepository(),
      new FixDiscountPolicy());
  }
}
```

AppConfigì—ì„œëŠ” **ì‹¤ì œ ë™ì‘ì— í•„ìš”í•œ êµ¬í˜„ ê°ì²´ë¥¼ ì§ì ‘ ìƒì„±í•˜ì—¬, ìƒì„±í•œ ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì˜ ì°¸ì¡°(ë ˆí¼ëŸ°ìŠ¤)ë¥¼ ìƒì„±ìë¥¼ í†µí•´ ì£¼ì…**í•œë‹¤.

## MemberServiceImpl
ì´ë¥¼ ìœ„í•´ MemberServiceImpl í´ë˜ìŠ¤ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ private final í‚¤ì›Œë“œì˜ ì¸í„°í˜ì´ìŠ¤ ì„ ì–¸ê³¼ ìƒì„±ìë¥¼ ë§Œë“ ë‹¤.
``` java
public class MemberServiceImpl implements MemberService {

    private MemberRepository memberRepository;

    public MemberServiceImpl(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

ìœ„ ì½”ë“œì—ì„œëŠ” MemberRepositoryë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ì—ë§Œ ì˜ì¡´í•˜ê³ , ìƒì„±ìë¥¼ í†µí•´ ì–´ë–¤ êµ¬í˜„ ê°ì²´ë¥¼ ì£¼ì…ë°›ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. í•´ë‹¹ ì •ë³´ëŠ” ì˜¤ì§ ì™¸ë¶€ AppConfig í´ë˜ìŠ¤ì—ì„œë§Œ ê²°ì •í•˜ê³  ì•Œ ìˆ˜ ìˆë‹¤.

ë”°ë¼ì„œ MemberServiceImplì€ **ì˜ì¡´ê´€ê³„ì— ëŒ€í•œ ì •ë³´ëŠ” ì™¸ë¶€ì— ì±…ì„**ì„ ë§¡ê¸°ê³ , **ì‹¤í–‰ì—ë§Œ ì§‘ì¤‘**í•œë‹¤.
![image](https://github.com/user-attachments/assets/3c21cd96-4eb5-4e30-820e-b6b4297c947d)

### íšŒì› ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨
ì•„ë˜ ê·¸ë¦¼ì„ ë³´ë©´, **appConfig ê°ì²´ì—ì„œ memoryMemberREpository ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , í•´ë‹¹ ê°ì²´ì˜ `x001`ì´ë¼ëŠ” ì°¸ì¡°ê°’(ì£¼ì†Œ)ë¥¼ memberServiceImplì„ ìƒì„±í•˜ë©° ìƒì„±ìë¡œ ì „ë‹¬**í•œë‹¤.

ì´ì™€ ê°™ì€ ìƒí™©ì„ ì™¸ë¶€ì—ì„œ ì˜ì¡´ê´€ê³„ë¥¼ ì£¼ì…í•˜ëŠ” ê²ƒìœ¼ë¡œ ë³´ê³ , DI(Dependency Injection) , ì˜ì¡´ê´€ê³„ ì£¼ì… ë˜ëŠ” ì˜ì¡´ì„± ì£¼ì… ì´ë¼ê³  í•œë‹¤.
![image](https://github.com/user-attachments/assets/da24a2c2-cd40-41b3-bf06-cefc698513b9)


## OrderServiceImpl
ë§ˆì°¬ê°€ì§€ë¡œ OrderServiceImplì—ì„œë„ ìƒì„±ì ì£¼ì…ì„ í†µí•´ ì˜ì¡´ê´€ê³„ë¥¼ ì™¸ë¶€ì—ì„œ ì„¤ì •ë°›ì„ ìˆ˜ ìˆë„ë¡ í•œë‹¤.
``` java
public class OrderServiceImpl implements OrderService{

    private MemberRepository memberRepository;
    private DiscountPolicy discountPolicy;

    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discountPrice = discountPolicy.discount(member, itemPrice);

        return new Order(memberId, itemName, itemPrice, discountPrice);
    }
}
```

## AppConfig ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸

Orderìª½ë§Œ ì‹¤í–‰ í´ë˜ìŠ¤ ë° í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚´í´ë³´ë„ë¡ í•˜ê² ë‹¤.

ì•„ë˜ì™€ ê°™ì´ êµ¬ì²´ í´ë˜ìŠ¤ ì„ íƒ ë° ê°ì²´ ìƒì„±ì„ ëª¨ë‘ AppConfigì— ìœ„ì„í•œë‹¤.
AppConfigë¥¼ í†µí•´ ê´€ì‹¬ì‚¬ê°€ ë¶„ë¦¬ë˜ì–´ OrderServiceImplì€ ì‹¤í–‰í•˜ëŠ” ì±…ì„ì—ë§Œ ì§‘ì¤‘í•œë‹¤.

``` java
public class OrderApp {
    public static void main(String[] args) {
        AppConfig appConfig = new AppConfig();
        MemberService memberService = appConfig.memberService();
        OrderService orderService = appConfig.orderService();

        Long memberId = 1L;
        Member member = new Member(1L,"MemberA", Grade.VIP);
        memberService.join(member);

        Order order = orderService.createOrder(memberId, "itemA", 20000);

        System.out.println("order = " + order);
    }
}
```

# AppConfig ë¦¬íŒ©í„°ë§
í•˜ì§€ë§Œ ì•„ì§ AppConfigì— ì¤‘ë³µ ì½”ë“œê°€ ì¡´ì¬í•˜ê³ , ì—­í• ì— ë”°ë¥¸ êµ¬í˜„ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë µë‹¤.

ì•„ë˜ì™€ ê°™ì´ ë¦¬íŒ©í„°ë§ì„ í†µí•´ ì¤‘ë³µì„ ì œê±°í•˜ê³ , ë©”ì„œë“œ ëª… returníƒ€ì…ì„ ë³´ê³  ì—­í• ê³¼ êµ¬í˜„ í´ë˜ìŠ¤ê°€ í•œëˆˆì— ë³´ì´ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

``` java
public class AppConfig {

    // ë©”ì„œë“œ ì´ë¦„ìœ¼ë¡œ ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë¦„ì„ ì„¤ì •í•œë‹¤.
    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    public OrderService orderService() {
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    public DiscountPolicy discountPolicy() {
//        return new FixDiscountPolicy();
        return new RateDiscountPolicy();
    }
}
```

<img width="919" alt="image" src="https://github.com/user-attachments/assets/8c9ff7d6-1eae-4a08-bd1e-bbe7e904a9a7">

# ìƒˆë¡œìš´ êµ¬ì¡°ì™€ í• ì¸ ì •ì±… ì ìš©
ì •ì•¡ í• ì¸ì„ ì •ë¥  í• ì¸ìœ¼ë¡œ ë³€ê²½í•´ ë³´ì.
ì•ì„œ ìš°ë¦¬ëŠ” AppConfigë¥¼ í†µí•´ ì‚¬ìš© ì˜ì—­ê³¼ ê°ì²´ ìƒì„± ë° êµ¬ì„±(Configuration)í•˜ëŠ” ì˜ì—­ìœ¼ë¡œ ë¶„ë¦¬í–ˆë‹¤.

ì •ë¥  í• ì¸ìœ¼ë¡œ ë³€ê²½í•˜ê¸° ìœ„í•´ í´ë¼ì´ì–¸íŠ¸(ì‚¬ìš© ì˜ì—­)ì˜ ì½”ë“œ ë³€ê²½ ì—†ì´ AppConfigì—ì„œ í• ì¸ êµ¬ì„± ì •ë³´ë¥¼ ë³€ê²½í•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.
<img width="882" alt="image" src="https://github.com/user-attachments/assets/e855a775-850c-4d8c-8722-e0aeae60c1f0">


## AppConfig
``` java
public DiscountPolicy discountPolicy() {
  // return new FixDiscountPolicy();
  return new RateDiscountPolicy();
}
```

> ì´ë ‡ê²Œ AppConfig í´ë˜ìŠ¤ë¡œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬ë¥¼ í†µí•´ DIP, OCPë¥¼ ëª¨ë‘ ë§Œì¡±í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.


# IoC, DI, ì»¨í…Œì´ë„ˆ
# IoC(Inversion of Control)

